{"version":3,"sources":["../../server/utils/objectId.js"],"names":["name","resolve","db","ObjectID","coll","collection","findOne","_id","result","insert","seq","findAndModify","$inc","new","value","nextSequence","setObjectID","id","obj","mdb"],"mappings":";;;;;;;;;;;;AAYO,oBAA4BA,IAA5B;AACE,sHAAY,iBAAOC,OAAP;AACZC,0BADY;AAEfD,gCAAQ,IAAIE,QAAJ,EAAR,EAFe;;;;AAMXC,4BANW,GAMJF,GAAGG,UAAH,CAAc,UAAd,CANI;;AAQED,+BAAKE,OAAL,CAAa,EAAEC,KAAKP,IAAP,EAAb,CARF,SAQbQ,MARa;AASbA,mCAAW,IATE;AAUTJ,+BAAKK,MAAL,CAAY,EAAEF,KAAKP,IAAP,EAAaU,KAAK,CAAlB,EAAZ,CAVS;AAWfT,gCAAQ,CAAR,EAXe;;AAaAG,+BAAKO,aAAL,CAAmB,EAAEJ,KAAKP,IAAP,EAAnB,EAAkC,IAAlC,EAAwC,EAAEY,MAAM,EAAEF,KAAK,CAAP,EAAR,EAAxC,EAA8D,EAAEG,KAAK,IAAP,EAA9D,CAbA,UAafL,MAbe;;AAefP,gCAAQO,OAAOM,KAAP,CAAaJ,GAArB,EAfe,gEAAZ,oEADF,kE,mBAAeK,Y,uDATNC,W,GAAAA,W,mBAKD,UAAUC,EAAV,EAAc,CAC3B,OAAO,IAAId,QAAJ,CAAac,EAAb,CAAP,CACD,C,8FAVD,IAAId,iBAAJ,CACA,IAAID,WAAJ,CAEO,SAASc,WAAT,CAAqBE,GAArB,EAA0BC,GAA1B,EAA+B,CACpChB,WAAWe,GAAX,CACAhB,KAAKiB,GAAL,CACD","file":"objectId.js","sourcesContent":["let ObjectID\nlet db\n\nexport function setObjectID(obj, mdb) {\n  ObjectID = obj\n  db = mdb\n}\n\nexport default function (id) {\n  return new ObjectID(id)\n}\n\nexport async function nextSequence(name) {\n  return new Promise(async (resolve) => {\n    if (!db) {\n      resolve(new ObjectID())\n      return\n    }\n\n    const coll = db.collection('counters')\n\n    let result = await coll.findOne({ _id: name })\n    if (result === null) {\n      await coll.insert({ _id: name, seq: 1 })\n      resolve(1)\n    } else {\n      result = await coll.findAndModify({ _id: name }, null, { $inc: { seq: 1 } }, { new: true })\n\n      resolve(result.value.seq)\n    }\n  })\n}\n"]}