'use strict';exports.__esModule = true;exports.pickEnum = undefined;var _typeof2 = require('babel-runtime/helpers/typeof');var _typeof3 = _interopRequireDefault(_typeof2);var _keys = require('babel-runtime/core-js/object/keys');var _keys2 = _interopRequireDefault(_keys);var _regenerator = require('babel-runtime/regenerator');var _regenerator2 = _interopRequireDefault(_regenerator);var _set = require('babel-runtime/core-js/set');var _set2 = _interopRequireDefault(_set);var _from = require('babel-runtime/core-js/array/from');var _from2 = _interopRequireDefault(_from);var _promise = require('babel-runtime/core-js/promise');var _promise2 = _interopRequireDefault(_promise);var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);var pickRef = function () {var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(


  function _callee2(field, db, getList) {var _this = this;return _regenerator2.default.wrap(function _callee2$(_context2) {while (1) {switch (_context2.prev = _context2.next) {case 0:return _context2.abrupt('return',
            new _promise2.default(function () {var _ref2 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(resolve, reject) {var times, values, list, value;return _regenerator2.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:
                        times = (0, _pick.random)(3);
                        values = [];case 2:if (!
                        times--) {_context.next = 10;break;}_context.next = 5;return (
                          getList(db.collection(field.sourceRef), {}, 1, 20));case 5:list = _context.sent;
                        value = (0, _strings.substitute)(field.valueTpl || '{_id}', (0, _pick.one)(list.list));
                        values.push(value);_context.next = 2;break;case 10:

                        values = (0, _from2.default)(new _set2.default(values));
                        if (field.sep) values = values.join(field.sep);
                        resolve(field.mult ? values : values[0]);case 13:case 'end':return _context.stop();}}}, _callee, _this);}));return function (_x4, _x5) {return _ref2.apply(this, arguments);};}()));case 1:case 'end':return _context2.stop();}}}, _callee2, this);}));return function pickRef(_x, _x2, _x3) {return _ref.apply(this, arguments);};}();var pickJson = function () {var _ref3 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(



  function _callee3(field) {return _regenerator2.default.wrap(function _callee3$(_context3) {while (1) {switch (_context3.prev = _context3.next) {case 0:return _context3.abrupt('return',
            new _promise2.default(function (resolve, reject) {
              var data = field.sourceJson;
              if (!Array.isArray(data)) {
                data = (0, _keys2.default)(data).map(function (k) {return {
                    _id: k,
                    text: data[k] };});

              } else {
                data = data.map(function (d) {
                  if ((typeof d === 'undefined' ? 'undefined' : (0, _typeof3.default)(d)) === 'object') return d;
                  return { _id: d };
                });
              }

              var times = (0, _pick.random)(3);
              var values = [];
              while (times--) {
                var value = (0, _strings.substitute)(field.valueTpl || '{_id}', (0, _pick.one)(data));
                values.push(value);
              }
              values = (0, _from2.default)(new _set2.default(values));
              if (field.sep) values = values.join(field.sep);
              resolve(field.mult ? values : values[0]);
            }));case 1:case 'end':return _context3.stop();}}}, _callee3, this);}));return function pickJson(_x6) {return _ref3.apply(this, arguments);};}();var pickEnum = exports.pickEnum = function () {var _ref4 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(


  function _callee4(field, db, getList) {var sourceType;return _regenerator2.default.wrap(function _callee4$(_context4) {while (1) {switch (_context4.prev = _context4.next) {case 0:
            sourceType = field.sourceType;_context4.t0 =
            sourceType;_context4.next = _context4.t0 ===
            'json' ? 4 : _context4.t0 ===

            'ref' ? 7 : 10;break;case 4:_context4.next = 6;return pickJson(field);case 6:return _context4.abrupt('return', _context4.sent);case 7:_context4.next = 9;return (
              pickRef(field, db, getList));case 9:return _context4.abrupt('return', _context4.sent);case 10:case 'end':return _context4.stop();}}}, _callee4, this);}));return function pickEnum(_x7, _x8, _x9) {return _ref4.apply(this, arguments);};}();var _pick = require('./pick');var _strings = require('../strings');function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}
//# sourceMappingURL=enum.js.map