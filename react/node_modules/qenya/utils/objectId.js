'use strict';exports.__esModule = true;exports.nextSequence = undefined;var _regenerator = require('babel-runtime/regenerator');var _regenerator2 = _interopRequireDefault(_regenerator);var _promise = require('babel-runtime/core-js/promise');var _promise2 = _interopRequireDefault(_promise);var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);var nextSequence = exports.nextSequence = function () {var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(











  function _callee2(name) {var _this = this;return _regenerator2.default.wrap(function _callee2$(_context2) {while (1) {switch (_context2.prev = _context2.next) {case 0:return _context2.abrupt('return',
            new _promise2.default(function () {var _ref2 = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(resolve) {var coll, result;return _regenerator2.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:if (
                        db) {_context.next = 3;break;}
                        resolve(new ObjectID());return _context.abrupt('return');case 3:



                        coll = db.collection('counters');_context.next = 6;return (

                          coll.findOne({ _id: name }));case 6:result = _context.sent;if (!(
                        result === null)) {_context.next = 13;break;}_context.next = 10;return (
                          coll.insert({ _id: name, seq: 1 }));case 10:
                        resolve(1);_context.next = 17;break;case 13:_context.next = 15;return (

                          coll.findAndModify({ _id: name }, null, { $inc: { seq: 1 } }, { new: true }));case 15:result = _context.sent;

                        resolve(result.value.seq);case 17:case 'end':return _context.stop();}}}, _callee, _this);}));return function (_x2) {return _ref2.apply(this, arguments);};}()));case 1:case 'end':return _context2.stop();}}}, _callee2, this);}));return function nextSequence(_x) {return _ref.apply(this, arguments);};}();exports.setObjectID = setObjectID;exports.default = function (id) {return new ObjectID(id);};function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}var ObjectID = void 0;var db = void 0;function setObjectID(obj, mdb) {ObjectID = obj;db = mdb;}
//# sourceMappingURL=objectId.js.map